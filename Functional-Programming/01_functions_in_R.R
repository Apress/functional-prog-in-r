## ------------------------------------------------------------------------
square <- function(x) x**2

## ------------------------------------------------------------------------
square(1:5)

## ------------------------------------------------------------------------
rescale <- function(x) {
    m <- mean(x)
    s <- sd(x)
    (x - m) / s
}

## ------------------------------------------------------------------------
(x <- 1:5)

## ---- echo=FALSE---------------------------------------------------------
rm(x)

## ------------------------------------------------------------------------
rescale <- function(x, only_translate) {
    m <- mean(x)
    translated <- x - m
    if (only_translate) return(translated)
    s <- sd(x)
    translated / s
}
rescale(1:4, TRUE)
rescale(1:4, FALSE)

## ---- results="hide"-----------------------------------------------------
rescale(x = 1:4, only_translate = TRUE)
rescale(x = 1:4, only_translate = FALSE)

## ---- results="hide"-----------------------------------------------------
rescale(only_translate = TRUE, x = 1:4)
rescale(only_translate = FALSE, x = 1:4)

## ---- results="hide"-----------------------------------------------------
rescale(1:4, only_translate = TRUE)
rescale(only_translate = TRUE, 1:4)
rescale(x = 1:4, TRUE)
rescale(TRUE, x = 1:4)

## ---- results="hide"-----------------------------------------------------
rescale(1:4, o = TRUE)
rescale(o = TRUE, 1:4)

## ------------------------------------------------------------------------
rescale <- function(x, only_translate = FALSE) {
    m <- mean(x)
    translated <- x - m
    if (only_translate) return(translated)
    s <- sd(x)
    translated / s
}

## ---- result="hide"------------------------------------------------------
rescale(1:4)

## ------------------------------------------------------------------------
rescale <- function(x, ...) {
    m <- mean(x, ...)
    s <- sd(x, ...)
    (x - m) / s
}

## ------------------------------------------------------------------------
x <- c(NA, 1:3)
rescale(x)

## ------------------------------------------------------------------------
rescale(x, na.rm = TRUE)

## ------------------------------------------------------------------------
f <- function(x) x
g <- function(x, ...) x
f(1:4, foo = "bar")
g(1:4, foo = "bar")

## ------------------------------------------------------------------------
f <- function(...) list(...)
g <- function(x, y, ...) f(...)
g(x = 1, y = 2, z = 3, w = 4)

## ------------------------------------------------------------------------
f <- function(w) w
g <- function(x, y, ...) f(...)
g(x = 1, y = 2, z = 3, w = 4)

## ------------------------------------------------------------------------
parameters <- function(...) eval(substitute(alist(...)))
parameters(a = 4, b = a**2)

## ------------------------------------------------------------------------
alist(a = 4, b = a**2)

## ------------------------------------------------------------------------
list(a = 4, b = a**2)

## ------------------------------------------------------------------------
parameters <- function(...) alist(...)
parameters(a = 4, b = x**2)

## ------------------------------------------------------------------------
(function(x) x**2)(2)

## ------------------------------------------------------------------------
f <- function(a, b) a
f(2, stop("error if evaluated"))
f(stop("error if evaluated"), 2)

## ------------------------------------------------------------------------
f <- function(a, b = a) a + b
f(a = 2)

## ------------------------------------------------------------------------
a <- 4
f <- function(x) {
    a <- 2
    x
}
f(1 + a)

## ---- echo=FALSE---------------------------------------------------------
rm(a)

## ------------------------------------------------------------------------
f <- function(a) function(b) a + b

## ------------------------------------------------------------------------
f(2)(2)

## ------------------------------------------------------------------------
ff <- vector("list", 4)
for (i in 1:4) {
  ff[[i]] <- f(i)
}
ff

## ------------------------------------------------------------------------
ff[[1]](1)

## ------------------------------------------------------------------------
i <- 1
ff[[2]](1)

## ------------------------------------------------------------------------
i <- 2
ff[[2]](1)

## ------------------------------------------------------------------------
results <- vector("numeric", 4)
for (i in 1:4) {
  results[i] <- ff[[i]](1)
}
results

## ------------------------------------------------------------------------
f <- function(a) {
  force(a)
  function(b) a + b
}

ff <- vector("list", 4)
for (i in 1:4) {
  ff[[i]] <- f(i)
}

ff[[1]](1)
i <- 1
ff[[2]](1)

## ------------------------------------------------------------------------
parameters <- function(...) eval(substitute(alist(...)))

p <- parameters(x = 2)
class(p$x)

## ------------------------------------------------------------------------
a <- 2
p <- parameters(x = a)
class(p$x)

## ------------------------------------------------------------------------
eval(p$x)

## ------------------------------------------------------------------------
a <- 4
eval(p$x)

## ---- echo=FALSE---------------------------------------------------------
rm(a)

## ------------------------------------------------------------------------
p <- parameters(x = 2 * y)
class(p$x)

## ------------------------------------------------------------------------
eval(p$x)

## ------------------------------------------------------------------------
parameters2 <- function(...) {
  y <- 2
  eval(substitute(alist(...)))
}
p2 <- parameters(x = 2 * y)
eval(p2$x)

## ------------------------------------------------------------------------
y <- 2
eval(p$x)

## ------------------------------------------------------------------------
eval(p$x, list(y = 4))

## ---- echo=FALSE---------------------------------------------------------
rm(y)

## ------------------------------------------------------------------------
x <- 1:5
y <- 6:10
x - y

## ------------------------------------------------------------------------
2 * x

## ------------------------------------------------------------------------
x <- 1:6
y <- 1:3
x - y

## ------------------------------------------------------------------------
log(1:3) - sqrt(1:3)

## ------------------------------------------------------------------------
f <- function(a, b) log(a) - sqrt(b)
f(1:3, 1:3)

## ------------------------------------------------------------------------
compare <- function(x, y) {
    if (x < y) {
        -1
    } else if (y < x) {
        1
    } else {
        0
    }
}

## ------------------------------------------------------------------------
compare <- function(x, y) {
    ifelse(x < y, -1, ifelse(y < x, 1, 0))
}
compare(1:6, 1:3)

## ------------------------------------------------------------------------
compare <- function(x, y) {
    if (x < y) {
        -1
    } else if (y < x) {
        1
    } else {
        0
    }
}
compare <- Vectorize(compare)
compare(1:6, 1:3)

## ------------------------------------------------------------------------
scale_with <- function(x, y) {
    (x - mean(y)) / sd(y)
}

## ------------------------------------------------------------------------
scale_with(1:6, 1:3)
scale_with <- Vectorize(scale_with)
scale_with(1:6, 1:3)

## ------------------------------------------------------------------------
scale_with <- function(x, y) {
    (x - mean(y)) / sd(y)
}
scale_with <- Vectorize(scale_with, vectorize.args="x")
scale_with(1:6, 1:3)

## ------------------------------------------------------------------------
make_node <- function(name, left = NULL, right = NULL) 
  list(name = name, left = left, right = right)

tree <- make_node("root", 
                  make_node("C", make_node("A"), 
                                 make_node("B")),
                  make_node("D"))

## ------------------------------------------------------------------------
node_depth <- function(tree, name, depth = 0) {
    if (is.null(tree))     return(NA)
    if (tree$name == name) return(depth)

    left <- node_depth(tree$left, name, depth + 1)
    if (!is.na(left)) return(left)
    right <- node_depth(tree$right, name, depth + 1)
    return(right)
}

## ------------------------------------------------------------------------
node_depth(tree, "D")
node_depth(tree, "A")

## ------------------------------------------------------------------------
node_depth <- Vectorize(node_depth, vectorize.args = "name", 
                        USE.NAMES = FALSE)
node_depth(tree, c("A", "B", "C", "D"))

## ------------------------------------------------------------------------
`+`(2, 2)

## ------------------------------------------------------------------------
`if`(2 > 3, "true", "false")

## ------------------------------------------------------------------------
`%x%` <- `*`
3 %x% 2

## ------------------------------------------------------------------------
`%x%` <- function(expr, num) replicate(num, expr)
3 %x% 5
cat("This is ", "very " %x% 3, "much fun")

## ------------------------------------------------------------------------
rnorm(1) %x% 4

## ------------------------------------------------------------------------
`%x%` <- function(expr, num) {
  m <- match.call()
  replicate(num, eval.parent(m$expr))
}
rnorm(1) %x% 4

## ------------------------------------------------------------------------
x <- y <- 1:5
x
y
x[1] <- 6
x
y

## ------------------------------------------------------------------------
rm(x) ; rm(y)
mem_change(x <- 1:10000000)
address(x)
mem_change(x[1] <- 6)
address(x)

## ------------------------------------------------------------------------
class(6)
class(6L)

## ------------------------------------------------------------------------
z <- 1:5
class(z)
z[1] <- 6
class(z)

## ---- echo=FALSE---------------------------------------------------------
rm(z)

## ------------------------------------------------------------------------
mem_change(x[3] <- 8)
address(x)

## ------------------------------------------------------------------------
mem_change(y <- x)
address(x)
address(y)

## ------------------------------------------------------------------------
mem_change(x[3] <- 8)
address(x)
address(y)

## ------------------------------------------------------------------------
mem_change(x[4] <- 9)
address(x)

## ---- echo=FALSE---------------------------------------------------------
rm(x) ; rm(y)

## ------------------------------------------------------------------------
x <- 1:4
x
names(x) <- letters[1:4]
x
names(x)

## ------------------------------------------------------------------------
names(x) <- letters[1:4]

## ------------------------------------------------------------------------
x <- `names<-`(x, letters[1:4])

## ------------------------------------------------------------------------
x <- 1:4
attributes(x)
attributes(x) <- list(foo = "bar")
attributes(x)
attr(x, "baz") <- "qux"
attributes(x)

## ------------------------------------------------------------------------
tree <- make_node("root", 
                  make_node("C", make_node("A"), 
                                 make_node("B")),
                  make_node("D"))

## ------------------------------------------------------------------------
`left<-` <- function(node, value) {
    node$left = value
    node
}
`right<-` <- function(node, value) {
    node$right = value
    node
}

## ------------------------------------------------------------------------
A <- make_node("A")
B <- make_node("B")
C <- make_node("C")
D <- make_node("D")
root <- make_node("root")
left(C) <- A
right(C) <- B
left(root) <- C
right(root) <- D
tree <- root

## ------------------------------------------------------------------------
print_tree <- function(tree) {
  build_string <- function(node) {
    if (is.null(node$left) && is.null(node$right)) {
        node$name
    } else {
        left <- build_string(node$left)
        right <- build_string(node$right)
        paste0("(", left, ",", right, ")")
    }
  }
  build_string(tree)
}
print_tree(tree)

## ------------------------------------------------------------------------
A <- make_node("A")
B <- make_node("B")
C <- make_node("C")
D <- make_node("D")
root <- make_node("root")
left(root) <- C
right(root) <- D
left(C) <- A
right(C) <- B
tree <- root
print_tree(tree)

